---
title: Bankfull Metrics
---

The bankfull metrics tool calculates Bankfull Volume, and max and mean Bankfull Depths.

# Usage

## Inputs

* Topo Survey must be processed and contain the following:
  * Topo Points with some 'bf' points
  * DEM
  * Detrended DEM


## Outputs

The following datasets are generated by this tool:

* `bankfull_metrics.xml`  

## Summery of Methods

1. Use BF points to Sample Detrended DEM elevations
   1. remove points that fall outside of detrendedDEM data extent
2. Make sure DEM and DetrendedDEM have concurrent extents.
3. Find average bf detrended elevation
4. Generate Detrended BF Elevation Surface as constant raster of average BF detrended elevations
5. Generate Trend Grid (DEM minus DetrendedDEM) 
6. Add Trend Grid to Detrended BF Elevation Surface to Generate BF Elevation Surface.
7. Generate Depth Raster
   1. Bankfull Elevation Surface minus DEM
   2. Remove negative depths.
8. Multiply by cell size to determine BF volume
9. Find Mean and Max depth of bf depth surface.

### Differences from RBT version

Primary difference between this metric calculation method and the RBT method is that the RBT used IDW to generate a bf surface whereas this method uses the average bf elevations to create a constant bankfull elevation raster. 

While using the average detrended bf elevation could result in over/under estimating the bankfull surface in some locations (due applying one site-based value across the entire site), this method does have a better overall approximation of bankfull elevation by reducing the local effects of anomalous points, whereas IDW might be placing more emphasis on individual bf points that already have higher uncertainty.  Since the elevations used are already in a detrended environment, the goal is to find a best fit stage elevation rather than model local elevation variation of bankfull (which is likely due to subjective interpretation of bf indicators by the field crew).

## Syntax

Command Line parameters for `substrate_raster.py`:

* Positional Arguments
  * `visitID` (int) the visit id of the site to use (no spaces)
  * `outputfolder` (str) output folder for the xml results and log files.
* Optional Arguments
  *  `datafolder` (str) Top level folder containing Topo Project Riverscapes projects
  *  `verbose` (bool) Get more information in your logs.

# About

- **Code Repository** https://github.com/SouthForkResearch/CHaMP_Metrics
- **Software Architecture** Python 2.7 with standard library and the following 3rd-Party Dependencies:
  - bankfull methods
    - geopandas
    - numpy
    - rasterio
- **Batch Processing** this script is designed to work with CHaMP_Automation on AWS or with `batch_run.py` tool
- Overall methods developed by Philip Bailey at North Arrow Research.
- Code written and maintained by Kelly Whitehead at South Fork Research.

# Release Notes

- `version 0.0.1`  2018-02-07
  - Initial version of tool released

[TOOL HOME](index.md)
